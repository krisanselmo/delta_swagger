
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Editor</title>

  <!-- Jquery -->
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>


  <!-- Bootstrap core -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


  <script type="text/javascript" src="src/yaml.js"></script>


  <script src="src/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
  <link rel="stylesheet" type="text/css" href="src/delta_swagger.css">

</head>
<body>


<nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container2">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Î” Swagger</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#contact">Contact</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>



<div class="container">

  <div class="divsplit">
    <pre id="editor"></pre>
  </div>

  <div class="divsplit">
    <pre id="editor2"></pre>
  </div>

  <div class="divsplit result">
    <h2>Objets:</h2>
    <div id="objects"></div>
  </div>

</div>

<!-- <pre id="editor2" class="divsplit">
  
</pre> -->




<script>
    
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.session.setMode("ace/mode/yaml");

    var editor2 = ace.edit("editor2");
    editor2.setTheme("ace/theme/monokai");
    editor2.session.setMode("ace/mode/yaml");

    if (localStorage.getItem("swagger") != null){
        editor.setValue(localStorage.getItem("swagger"));
        editor.setValue(editor.getValue(), 1);
    }

    if (localStorage.getItem("swagger2") != null){
        editor2.setValue(localStorage.getItem("swagger2"));
        editor2.setValue(editor2.getValue(), 1);
    }

    
    editor.getSession().on('change', function() {
      compute();
    });

    editor2.getSession().on('change', function() {
      compute();
    });

    // https://stackoverflow.com/questions/10134724/resize-ajax-org-ace-editor-based-on-browsers-size
    function resizeAce(id) {
        
        return $(id).height($(window).height()-100);

        // var h = window.innerHeight;
        // if (h > 360) {
        //     $(id).css('height', (h - 60).toString() + 'px');
        // }
    };

    //listen for changes
    $(window).resize(resizeAce('#editor'));
    $(window).resize(resizeAce('#editor2'));
    //set initially
    


    // When page is ready
    $(function() {
      compute();
      resizeAce('#editor')
      resizeAce('#editor2')
    });

    var text_swagger1;
    var text_swagger2;
    // var test1;

      


    function compute() {
      $("#objects").html("")


      text_swagger1 = editor.getValue();
      localStorage.setItem("swagger", text_swagger1);

      text_swagger2 = editor2.getValue();
      localStorage.setItem("swagger2", text_swagger2);
      


      js_swagger1 = YAML.eval(text_swagger1);
      str = JSON.stringify(js_swagger1.definitions);

      target = js_swagger1.definitions
      var textarea_content = "";
      for (var k in target){

        if (hasUpperCase(k)){
          $("#objects").append("<h3 class='red' title='Not in snake_case'>" + k + "</h3>");
        } else {
          $("#objects").append("<h3>" + k + "</h3>");
        }

        for (var j in target[k].properties){

          attribut_type = target[k].properties[j].type

          if (hasUpperCase(j)){
              $("#objects").append("<br><span class='red' title='Not in snake_case'>" + j + " - " + attribut_type + "</span>");
            } else {
              $("#objects").append("<br><span>" + j + " - " + attribut_type + "</span>");
            }

            if (listWithoutS(j, attribut_type)) {
              $("#objects").append("<br><span class='purple' title='Lists must end with: s'>" + j + " - " + attribut_type + "</span>");
            }

          }





      }
    }



    // if (target.hasOwnProperty(k)) {
    //          if (hasUpperCase(k)){
    //            $("#objects").append("<br>" + target[k].type + " - " + k)
    //          }
    //        }

      // $("#objects").html(textarea_content);


    function listWithoutS(attribut_name, attribut_type) {
        if ((attribut_name.slice(-1) != "s") && attribut_type == 'array') {
            return true;
        }
        return false;
    }


    function hasUpperCase(str) {
        if(str.toLowerCase() != str) {
            return true;
        }
        return false;
    }

    // window.onload = function() {
    //        var test1 = YAML.eval("---\n- one\n- two");
    //        var test2 = YAML.eval("---\none: two");

    //        YAML.fromURL("example.yml", function(data) {
    //            var errors = YAML.getErrors();
    //            if(errors.length == 0)
    //                document.getElementById("out").innerHTML = "Done! Took " + YAML.getProcessingTime() + " miliseconds.";
    //            else {
    //                document.getElementById("out").innerHTML = errors.join("<br>");
    //            }
    //        });
    //    };




</script>

</body>
</html>
