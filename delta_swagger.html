<!DOCTYPE html>
<html>
<head>
	<title>Delta Swagger</title>
  	<!-- <script src="http://code.jquery.com/jquery-latest.min.js"></script> -->
	<script src="https://code.jquery.com/jquery-3.2.1.min.js"
	integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
	crossorigin="anonymous"></script>
	
	<script src="src/js.cookie.js"></script>  
  
  	<!-- https://code.google.com/archive/p/javascript-yaml-parser/downloads -->
  	<script type="text/javascript" src="src/yaml.js"></script>

  	<!-- http://alan.blog-city.com/jquerylinedtextarea.htm -->
  	<!-- <script type="text/javascript" src="jquery-linedtextarea.js"></script> -->
	<!-- <link href="jquery-linedtextarea.css" type="text/css" rel="stylesheet" /> -->


</head>


<style type="text/css">

	body, html{
		width: 100%;
		height: 100%;
	}

	.content{
		width: 80%;
		text-align: center;
	}


	div>textarea{
		width: 100%;
		height: 200px;
	}

	textarea{
	    background: url(http://i.imgur.com/2cOaJ.png);
		background-attachment: local;
		background-repeat: no-repeat;
		padding-left: 35px;
		padding-top: 10px;
	    border-color:#ccc;
	}

	.result{
		width: 100%;
		text-align: left;
	}

	.red{
		color: red;
	}

</style>

<body>
  

<div class='content'>

	<h1>Î” Swagger</h1>

<!-- 
	Track camelCase
	Liste sans "s"

 -->




	<form action="#" onchange="compute();">  
		<div id="swagger1">
			<textarea class="lined"></textarea>
		</div>
	
		<div id="swagger2">
			<textarea class="lined"></textarea>
		</div>
	</form>


	<div class="result">
		<h2>Objets</h2>
		<div id="objects"></div>
	</div>

</div>


<script>

	// $(document).ready(function () {
	// 	$("#swagger2>textarea").html("coucou")

	// });
	// $(function() {
	// 	$(".lined").linedtextarea(
	// 		{selectedLine: 1}
	// 	);
	// });

	if (localStorage.getItem("swagger1") != null){
        $("#swagger1>textarea").html(localStorage.getItem("swagger1"))
    }
    if (localStorage.getItem("swagger2") != null){
        $("#swagger2>textarea").html(localStorage.getItem("swagger2"))
    }

	var text_swagger1;
	var test1;

	$(function() {
		compute();
	});


	function compute() {
		$("#objects").html("")

		text_swagger1 = $("#swagger1>textarea")[0].value
		localStorage.setItem("swagger1", text_swagger1);
		text_swagger2 = $("#swagger2>textarea")[0].value
		localStorage.setItem("swagger2", text_swagger2);


		js_swagger1 = YAML.eval(text_swagger1);
		str = JSON.stringify(js_swagger1.definitions);

		target = js_swagger1.definitions
		var textarea_content = "";
		for (var k in target){

			if (hasUpperCase(k)){
				$("#objects").append("<h3 class='red'>" + k + "</h3>");
			} else {
				$("#objects").append("<h3>" + k + "</h3>");
			}

			for (var j in target[k].properties){

    			if (hasUpperCase(j)){
		    		$("#objects").append("<br><span class='red'>" + j + " - " + target[k].properties[j].type + "</span>");
		    	} else {
		    		$("#objects").append("<br><span>" + j + " - " + target[k].properties[j].type + "</span>");
		    	}
	    	}


		}
	}



// if (target.hasOwnProperty(k)) {
// 		    	if (hasUpperCase(k)){
// 		    		$("#objects").append("<br>" + target[k].type + " - " + k)
// 		    	}
// 		    }

		// $("#objects").html(textarea_content);



	

	function hasUpperCase(str) {
        if(str.toLowerCase() != str) {
            return true;
        }
        return false;
    }

	// window.onload = function() {
 //        var test1 = YAML.eval("---\n- one\n- two");
 //        var test2 = YAML.eval("---\none: two");
    
 //        YAML.fromURL("example.yml", function(data) {
 //            var errors = YAML.getErrors();
 //            if(errors.length == 0)
 //                document.getElementById("out").innerHTML = "Done! Took " + YAML.getProcessingTime() + " miliseconds.";
 //            else {
 //                document.getElementById("out").innerHTML = errors.join("<br>");
 //            }
 //        });
 //    };

</script>

</body>
</html>